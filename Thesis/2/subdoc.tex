% this file is called up by thesis.tex
% content in this file will be fed into the main document

\chapter{Graphic User Interface Design} % top level followed by section, subsection

\section{Overview}
In chapter 2, I will describe the GUI design of the HCMP Player, focusing 
be on how the GUI design meets the requirement of the HCMP Player. I will describe
each GUI components' 
usage and function. The GUI of the HCMP Player contains 5 components, 
a detailed explaination of each component will be given in following sections. 
Figure 2.1 is a screenshot of GUI of the HCMP Player. 

\begin{figure}[H]
\center{\includegraphics[width=0.75\linewidth]{2/1.png}}
\caption{HCMP Player GUI Screenshot}
\label{fig:speciation}
\end{figure}

\section{Layout}
Figure 3 is a layout of the GUI of HCMP Player. The whole area 
covers 800 * 600 pixels. The top part is the menu panel 800 * 200 pixels in size. 
The track panel and 
library panel share the middle-left part, each is 200 * 200 pixles in size. 
The middle-right part is 400 * 600 pixels in size, and covering the most of the GUI, 
it will hold a midi keyboard and data display component. To bottom part is the channel   
panel. The bound every component to its own area, I put a container panel at the outmost 
layer. The container panel defines the boundary of the GUI of the HCMP Player. Any 
component out of this boundary is invible to users. 

\begin{figure}[H]
\center{\includegraphics[width=0.6\linewidth]{2/5.png}}
\caption{HCMP Player Layout}
\label{fig:speciation}
\end{figure}

\section{GUI Component}

\subsection{Menu Panel}

Figure 2.3 is a screenshot of the menu panel. The menu panel integrates most of the control 
functions for the HCMP Player. New, open and save buttons form a group. The group is used to 
manipulate the configuration file. Play, pause and stop buttons form another group, 
this group is used to directly control the HCMP Player. 
The function of each button is just like its name suggest. The network button 
is for the HCMP Player  
network function, after clicking the button, the player will automatically 
initiate a connection to a remote server, the IP address and port number pair is 
predefined in the configuration file and can be easily changed. Once the connection is 
successfully built, all controls will be transferred to the remote server. 
This function will be explained in more detail in following
chapters.The menu panel also contains a slider to change 
tempo. The slider inidicate the scale coefficient of tempo value. For example, 
if the original tempo is 90 BMP, and the slider is set to scale coefficient 1.5, 
the tempo will be 1.5 * 90 
BMP when playing the file. The import button is used to import a midi file 
into the HCMP Player, once a midi file is successuflly imported into the HCMP Player  
, the track panel, library panel and data display component will be updated. 
The track path will also be recorded into the configuration file, so that the user 
will not need to import the same file again.

\begin{figure}[H]
\center{\includegraphics[width=0.8\linewidth]{2/6.png}}
\caption{HCMP Player Menu Panel}
\label{fig:speciation}
\end{figure}

\subsection{Track Panel}

Figure 2.4 is a screenshot of the track panel. The track panel is used to 
control each track's parameters, volume, solo, mute. The color
block at the front of panel indicates its color in the data display component . The 
track panel will automatically be populated once a midi file is successfully 
loaded into the HCMP Player.
\begin{figure}[H]
\center{\includegraphics[width=0.3\linewidth]{2/7.png}}
\caption{HCMP Player Track Panel}
\label{fig:speciation}
\end{figure}

\subsection{Midi Keyboard and Data Display}
Figure 2.5 is a screenshot of the data display component. It is made up of a virtual  
keyboard and a midi note canvas. After successfuly loading a midi file, the midi 
note canvas will 
draw each midi note in this area. When playing a midi file, the midi canvas will 
automatically update the position of each midi note. 

The virtual keyboard has 9 octaves and 108 keys. Both the white and black keys 
are drawn by the canvas. Every midi note will be highlighted in the 
virtual midi keyboard, based on its pitch, while playing. This avoids asynchronized speed 
of canvas update and playing midi note problems. The canvas update speed is 
coordinited with the player engine. Player engine is responsible for beat update and it 
periodically sends synchronization information to the GUI. After receiving updated 
information from the player engine, the GUI will update all midi notes in canvas.

Each color of the midi note represents a track inside 
a midi file. In the current version, the color for each track's midi note is predefined. 
Midi canvas scroll speed is linear to the tempo of midi. Whenever a user 
makes a change to the tempo, the scroll speed of the midi canvas will adjust
accordingly. When a user mutes a
track, its color midi note in midi canvas will temporarily be set to invisble. 
The canvas
update frequency is 20Hz. To make logic easier, everytime an update event 
happens, the whole midi canvas will be redrawn. The midi canvas is 400 * 600 pixels 
in size, and these pixels are updates 20 times every second, which is approximately 
20 frames per second. The performance is not
a major concern. There is a canvas buffer data 
structure to store all the ``visble'' midi notes. 
Usually, the size of a midi file is no more than 10MB, the overall performance of 
using redraw method is acceptable.

\begin{figure}[H]
\center{\includegraphics[width=0.7\linewidth]{2/3.png}}
\caption{HCMP Player Data Display Component}
\label{fig:speciation}
\end{figure}

\subsection{HCMP Player Library}

Figure 2.6 is the screenshot of midi library panel. This simple midi library is 
used to remember all the midi file that has ever been successfully loaded . 
A configration file of HCMP Player store all the file name as well as its path, 
so that next time when user launch HCMP Player again, it is able to load these 
recently openned midi files immediately. Everytime a user click any file in the libary, 
The GUI looks up a hash-like data structure and fetch its file path (if exist),
it then is automatically
loaded into the HCMP Player. If the midi file failed to load, the library and its
configuration file will remove the obsolete entry and then update the library panel
agian.

\begin{figure}[H]
\center{\includegraphics[width=0.3\linewidth]{2/8.png}}
\caption{HCMP Player Library Panel}
\label{fig:speciation}
\end{figure}

\section{Player Mode}

The HCMP Player has two mode, stand-alone mode and network mode. 
In stand-alone mode, HCMP Player can be used as normal midi player 
, user could load and play midi file. In network mode, 
the HCMP Player will connect to a remote 
server, in HCMP project, the server usually contains a conductor, and this
conductor is responsible for communication and coordination with all the 
instance of HCMP Players. For example, 
a typical workflow of conductor is to read cue from external resource, 
then issue command all the connected instances of the HCMP Players.

\subsection{Stand-alone Mode}

When lauching the program, the HCMP player is default in stand-alone mode, 
all the GUI component's function is described like above. 
User could use HCMP Player to play midi file, change tempo, change volume, etc.


\subsection{Network Mode}

After launching the HCMP Player, if user click the network button, 
the HCMP player will try to enter into    
the network mode. At the beginning, it initiate a connection request 
to remote server, the address and port number will stored in the
HCMP Player configuration file. If receving no reply within certain 
timeout period, the HCMP player ``rollback'' to its stand-alone mode.
If receving confirm signal from
remote server, the 2-way connection between the HCMP Player and 
remote server is successfully built up. Then, the HCMP Player and 
remote server is able to communicate with each other. The control of HCMP 
Player will partially be ``transfered'' to remote server. 
In this mode, player control buttons like play, pause   
, stop still work as normal, to avoid conflict problems, other buttons will 
be temporarily disabled, which means binding method for these buttons is replaced by
another set of functions. The detailed network API information will be explained  
in the chapter 5.
